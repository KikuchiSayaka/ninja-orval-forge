# ninja-orval-forge

[![PyPI version](https://badge.fury.io/py/ninja-orval-forge.svg)](https://badge.fury.io/py/ninja-orval-forge)
[![Python 3.8+](https://img.shields.io/badge/python-3.8+-blue.svg)](https://www.python.org/downloads/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

**Django Ninja + Orval Integration Environment Builder**

A CLI tool for migrating from Django REST Framework (DRF) to Django Ninja and automatically building TypeScript type-safe frontend development environments.

## Features

- **DRF â†’ Django Ninja Auto Migration**: Automatically convert existing Serializers and ViewSets
- **Type-Safe API Development**: Complete integration of Pydantic + OpenAPI + TypeScript
- **Orval Auto Configuration**: Automatic generation of TypeScript clients and Vue/React components
- **Project Templates**: Practical directory structure and best practices
- **Vue 3 Integration**: Composition API compatible components and composables

## Installation

```bash
pip install ninja-orval-forge
```

## Quick Start

### 1. Project Initialization

```bash
cd your-django-project
ninja-orval-forge init --name "My API Project"
```

Interactive mode selection:

- Frontend framework (Vue/React/Angular)
- TypeScript usage
- Authentication settings
- Response format (camelCase)

### 2. API Feature Generation

```bash
# Generate new API endpoints
ninja-orval-forge generate users --model User

# Generate specific operations only
ninja-orval-forge generate products --model Product --operations list create update
```

### 3. DRF Migration

```bash
# Automatically convert existing DRF code
ninja-orval-forge migrate --app myapp --dry-run
ninja-orval-forge migrate --app myapp
```

### 4. TypeScript Client Generation

```bash
# Start Django development server
python manage.py runserver

# Generate client in separate terminal
npm run ninja:generate
```

## Generated File Structure

```
your-project/
â”œâ”€â”€ .ninja-orval-forge.yml          # Configuration file
â”œâ”€â”€ orval.config.ts                 # Orval configuration
â”œâ”€â”€ main/                           # Django app
â”‚   â””â”€â”€ apis/
â”‚       â””â”€â”€ ninja/
â”‚           â”œâ”€â”€ api.py              # Main API configuration
â”‚           â”œâ”€â”€ base_schemas.py     # Common API schemas
â”‚           â”œâ”€â”€ api_views/          # Feature-specific views
â”‚           â”‚   â””â”€â”€ users/
â”‚           â”‚       â”œâ”€â”€ schema.py   # User API-specific schemas
â”‚           â”‚       â””â”€â”€ views.py    # Django Ninja views
â”‚           â”œâ”€â”€ shared/             # Common utilities
â”‚           â”‚   â””â”€â”€ pagination_utils.py
â”‚           â””â”€â”€ openapi/            # OpenAPI schema (JSON format)
â””â”€â”€ frontend/                       # Frontend
    â”œâ”€â”€ api/                        # Orval output
    â”‚   â”œâ”€â”€ client/                 # API client functions
    â”‚   â””â”€â”€ schema/                 # TypeScript type definitions
    â”œâ”€â”€ composables/                # useXXX Composable functions
    â”‚   â””â”€â”€ useUsers.ts
    â””â”€â”€ components/
        â””â”€â”€ UserList.vue           # Generated Vue component
```

### Directory Roles

- **`openapi/`**: OpenAPI schema generated by Django Ninja (JSON format)
- **`base_schemas.py`**: Common API schemas for all APIs (pagination, etc.)
- **`api_views/*/schema.py`**: API-specific input/output schemas
- **`shared/`**: Common utilities (pagination, etc.)
- **`frontend/api/client/`**: API client functions generated by Orval
- **`frontend/api/schema/`**: TypeScript type definition files
- **`frontend/composables/`**: Vue Composable functions

## Command Reference

### `init` - Project Initialization

```bash
ninja-orval-forge init [OPTIONS]

Options:
  --name TEXT        Project name [required]
  --app TEXT         Django app name [default: main]
  --frontend CHOICE  Frontend framework [vue|react|angular|none]
  --interactive      Interactive mode [default: True]
  --force           Overwrite existing configuration
```

### `generate` - API Feature Generation

```bash
ninja-orval-forge generate FEATURE_NAME [OPTIONS]

Arguments:
  FEATURE_NAME  Feature name (e.g., users, products)

Options:
  --model TEXT              Target Django model [required]
  --operations [list|retrieve|create|update|delete]
                           Operations to generate (multiple allowed)
  --interactive            Interactive mode [default: True]
  --force                  Overwrite existing files
```

### `migrate` - DRF Migration

```bash
ninja-orval-forge migrate [OPTIONS]

Options:
  --app TEXT       Target app for migration [required]
  --dry-run        Show migration plan only, don't make changes
  --interactive    Interactive mode [default: True]
  --backup         Backup existing files [default: True]
```

## Configuration File

Customize detailed settings in `.ninja-orval-forge.yml`:

```yaml
project:
  name: "My API Project"
  django_app: "main"
  api_prefix: "/api/v1"
  api_version: "1.0.0"

ninja:
  auth_enabled: true
  auth_class: "JWTAuth"
  camel_case_response: true

orval:
  output_path: "./frontend/api/client"
  client_type: "fetch"
  split_mode: "tags-split"

frontend:
  framework: "vue"
  typescript: true

templates:
  pagination_limit: 20
  max_page_size: 100
  default_ordering: "-id"
```

## Generated Code Examples

### Django Ninja View

```python
from ninja import Router, Query, Path
from .schema import UserSchema, UserListSchema
from main.models import User

router = Router(tags=["users"])

@router.get("/users", response=UserListSchema)
def list_users(
    request,
    pagination: Query[PaginationQuery],
):
    qs = User.objects.all().order_by("-id")
    total_count = qs.count()
    paginated_qs = PaginatorResponseBuilder.paginate_queryset(qs, pagination)
    results = [UserSchema.model_validate(u).model_dump() for u in paginated_qs]
    return PaginatorResponseBuilder.build_response(total_count, results)
```

### Pydantic Schema

```python
from pydantic import BaseModel, Field, ConfigDict

class UserSchema(BaseModel):
    id: int
    email: str = Field(..., description="Email address")
    first_name: str = Field(..., description="First name")
    is_active: bool = Field(True, description="Active flag")

    model_config = ConfigDict(
        from_attributes=True,
        alias_generator=lambda field_name: ''.join(
            word.capitalize() if i else word for i, word in enumerate(field_name.split('_'))
        ),
    )
```

### Vue Component

```vue
<template>
  <div class="user-list">
    <table v-if="!loading && users.length > 0">
      <thead>
        <tr>
          <th>ID</th>
          <th>Email</th>
          <th>Name</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
        <tr v-for="user in users" :key="user.id">
          <td>{{ user.id }}</td>
          <td>{{ user.email }}</td>
          <td>{{ user.firstName }}</td>
          <td>{{ user.isActive ? "Active" : "Inactive" }}</td>
        </tr>
      </tbody>
    </table>
  </div>
</template>

<script setup lang="ts">
import { onMounted } from "vue";
import { useUserList } from "@/composables/useUsers";

const { state, fetchUsers } = useUserList();

onMounted(() => {
  fetchUsers();
});
</script>
```

## Development Workflow

1. **API Design**: Define Django models
2. **Generate**: Generate API code with `ninja-orval-forge generate`
3. **Test**: Verify APIs with SwaggerUI (`/ninja_api/docs`)
4. **Client Generation**: Generate TypeScript client with `npm run ninja:generate`
5. **Frontend Development**: Use type-safe API client for UI development

## Documentation

- [Installation Guide](docs/installation.md)
- [Tutorial](docs/tutorial.md)
- [Configuration Reference](docs/configuration.md)
- [Template Customization](docs/templates.md)
- [FAQ](docs/faq.md)

## Contributing

1. Fork the repository
2. Create your feature branch (`git checkout -b feature/amazing-feature`)
3. Commit your changes (`git commit -m 'Add some amazing feature'`)
4. Push to the branch (`git push origin feature/amazing-feature`)
5. Open a Pull Request

### Development Setup

```bash
git clone https://github.com/yourusername/ninja-orval-forge.git
cd ninja-orval-forge
poetry install
poetry shell

# Run tests
pytest

# Lint
ruff check .

# Format
black .
```

## License

MIT License - See the [LICENSE](LICENSE) file for details.

## Language

- [English](README.md)
- [æ—¥æœ¬èªž](README-ja.md)

---

**ninja-orval-forge** - Easy migration from DRF to Django Ninja with type-safe full-stack development ðŸ¥·âš¡
